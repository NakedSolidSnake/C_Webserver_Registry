<!DOCTYPE html>
<html>
    <head>
        <style>
            	body { 
			text-align: center; 
		} 

		h1 { 
			color: green; 
		} 

		/* Basic CSS to design table */ 
		table { 
			border-collapse: collapse; 
			width: 100%; 
		} 

		th, 
		td { 
			padding: 8px; 
			text-align: left; 
			border-bottom: 1px solid #ddd; 
		} 

		/* CSS command for the row to highlight */ 
		.highlight { 
			background-color: #b8b8b8; 
		} 
        </style>
        <script>

            class Person{
                id;
                name;
                address;
                age;
            }

            var id;

            function splitObject(objects){
                var splitedObjects = objects.split(';')
                return splitedObjects;
            }

            function createObject(values, object){
                if(values.length > 0){
                    var fields = values.split(',');
                    object.id = fields[0];
                    object.name = fields[1];
                    object.address = fields[2];
                    object.age = fields[3];
                    return true;
                }

                return false;
            }

            function addPerson(person) {
                var table = document.getElementById("myTable");
                var row = table.insertRow(1);
                var idCell1 = row.insertCell(0);
                var nameCell2 = row.insertCell(1);
                var addressCell3 = row.insertCell(2)
                var ageCell3 = row.insertCell(3)

                idCell1.innerHTML = person.id;
                nameCell2.innerHTML = person.name;
                addressCell3.innerHTML = person.address;
                ageCell3.innerHTML = person.age;

            }

            function getData(){
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
                    var objects = splitObject(xmlHttp.responseText);
                    for (let i = 0; i < objects.length; i++){
                        person = new Person();
                        if(createObject(objects[i], person) === true){
                            addPerson(person)
                        }
                    }
                }
            }
                xmlHttp.open("GET", "/send", true); // true for asynchronous 
                xmlHttp.send(null);

            }

            function getSelectedRow(){

                table = document.getElementById('myTable');
                var columns=table.querySelectorAll('td');
                for(var i=0;i<columns.length;i++)
                    console.log('Column '+i+': '+columns[i].innerHTML );               
            }


            
        </script>
    </head>

    <body onload="getData()">

        <p>Click the buttons to create and delete row(s) for the table.</p>

        <table id="myTable">
            <thead>
                <th>ID</th>
                <th>Name</th>
                <th>Address</th>
                <th>Age</th>
            </thead>         
        </table>

        <form action="/new" method="get">
            <button type="submit">New</button>
        </form>
        
        

        <script>
            var row_selected;

            function clearSelection(){
                var table = document.getElementById('myTable');
                var rows = table.querySelectorAll('tr');

                for(var i = 0; i < rows.length; i++){
                    rows[i].classList.remove('highlight'); 
                }
            }

            document.getElementById('myTable') 
			.addEventListener('click', function (item) { 

				// To get tr tag 
				// In the row where we click 				
                var row = item.path[1];
                row_selected = row; 

				// Toggle the highlight 
				if (row.classList.contains('highlight')) 
					row.classList.remove('highlight'); 
				else{    
                    clearSelection();                
                    row.classList.add('highlight'); 
                }
            });

            function httpSendData(id) {                            

                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function () {
                    if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
                        // console.log(xmlHttp.responseText);
                        window.location.replace('/');
                    }
                }

                xmlHttp.open("POST", "/delete", false); // true for asynchronous 
                xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                xmlHttp.send("id="+ id);
            }
            
            function getSelectedRow(){

                if(row_selected != null){
                    
                }else{
                    return;
                }

                id = row_selected.cells[0].innerHTML;
                
                return id;
            }

            function sendDelete(){
                httpSendData(getSelectedRow());
            }


            function getSelectedRowPerson(){

                if(row_selected != null){
                    
                }else{
                    return;
                }

                person = new Person();

                person.id = row_selected.cells[0].innerHTML;
                person.name = row_selected.cells[1].innerHTML;
                person.address = row_selected.cells[2].innerHTML;
                person.age = row_selected.cells[3].innerHTML;

                return person;
            }

            function httpSendDataEdit(person) {                            

                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function () {
                    if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
                        console.log(xmlHttp.responseText);

                    }
                }

                xmlHttp.open("POST", "/edit", true); // true for asynchronous 
                xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                xmlHttp.send("id="+ person.id +"&fname="+ person.name.replace(/\s/g, '+') +"&faddress="+ person.address.replace(/\s/g, '+') + "&fage=" + person.age);
            }

            function storePerson(person){
                // Check browser support
                if (typeof(Storage) !== "undefined") {
                // Store
                    localStorage.setItem("id", person.id);
                    localStorage.setItem("name", person.name);
                    localStorage.setItem("address", person.address);
                    localStorage.setItem("age", person.age);
                }
            }

            function sendEdit(){
                person = getSelectedRowPerson();
                storePerson(person)
                window.location.replace('/edit');
            }

        </script>

<button onclick="sendDelete()">Delete</button>
<button onclick="sendEdit()">Edit</button>
        
    </body>

</html>